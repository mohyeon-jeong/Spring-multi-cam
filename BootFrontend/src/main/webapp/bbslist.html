<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>bbslist</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

<script type="text/javascript" src="./jquery/jquery.twbsPagination.min.js"></script>

<style type="text/css">
.table th, .table td { 	text-align: center; 	vertical-align: middle!important; }
</style>

</head>
<body>

<h1>게시판</h1>

<hr>

<div align="center">
<table class="table table-hover table-sm" style="width: 1000px">
	<col width="70"><col width="600"><col width="100"><col width="150">
	<thead>
		<tr class="bg-primary" style="color: white;">
			<th>번호</th><th>제목</th><th>조회수</th><th>작성자</th>
		</tr>
	</thead>
	<tbody id="bbsBody">
		
	</tbody>
</table>
<br>
	<div class="container">
	    <nav aria-label="Page navigation">
	        <ul class="pagination" id="pagination" style="justify-content:center"></ul>
	    </nav>
	</div>
	<br>
	<div class="form-row align-items-center d-flex justify-content-center align-items-center container">
		<select id="choice">
			<option value="">검색</option>
			<option value="title">제목</option>
			<option value="content">내용</option>
			<option value="writer">작성자</option>
		</select>

		<div class="col-sm-2 my-1">
			<input type="text" id="search" class="form-control">
		</div>

		<button type="button" onclick="searchBtn()" class="btn btn-primary">검색</button>
	</div>
</div>

<script type="text/javascript">
$(document).ready(function() {
	getBbsList(0);
	
/* 	$.ajax({
		url:"http://localhost:3000/bbslist",
		type:"get",
		data:{ choice:"", search:"", pageNumber:0 },
		success:function(map){
			// alert(map);
			// alert(JSON.stringify(map));
			
			let list = map.list;
			// alert(list);
			let pageBbs = map.pageBbs;
			// alert(pageBbs);
			
			$.each(list, function (i, bbs) {
				let str = "<tr>"
							+	"<th>" + (i + 1) + "</th>"
							+	"<td style='text-align: left;'>" + bbs.title + "</td>"
							+	"<td>" + bbs.readcount + "</td>"
							+	"<td>" + bbs.id + "</td>"
						+ "</tr>"; 	
				$("#bbsBody").append(str);
			});			
		}, 
		error:function(){
			alert('error');
		}
	}); */
	function getBbsList( pn ) {
		let choice = $("#choice").val();
		let search = $("#search").val();
		
		$.ajax({
			url:"http://localhost:3000/bbslist",
			type:"get",
			data:{ "choice":choice, "search":search, "pageNumber":pn },
			success:function(map){
				let list = map.list;
				let pageBbs = map.pageBbs;
				
				$("#bbsBody").html("");
				
				$.each(list, function (i, bbs) {
					let str = "<tr>"
								+	"<th>" + (i + 1) + "</th>"
								+	"<td style='text-align: left;'>" + bbs.title + "</td>"
								+	"<td>" + bbs.readcount + "</td>"
								+	"<td>" + bbs.id + "</td>"
							+ "</tr>"; 	
					$("#bbsBody").append(str);
				});
				
				loadPaging(pageBbs);
			}, 
			error:function(){
				alert('error');
			}
		});
	}
	
	function searchBtn() {
		getBbsList( 0 );
	}
	
	function loadPaging(pageBbs) {
		$("#pagination").twbsPagination("destroy");
		
		$('#pagination').twbsPagination({
			totalPages : pageBbs,
			visiblePages : 10,
			first : "<span srid-hidden='true'>«</span>",
			prev : "이전",
			next : "다음",
			last : "<span srid-hidden='true'>»</span>",
			initiateStartPageClick : false,
			onPageClick : function(event, page) {
// 				let choice = document.getElementById('choice').value;
// 				let search = document.getElementById('search').value;
				
// 				location.href = "bbslist.do?choice=" + choice + "&search=" + search + "&pageNumber=" + (page - 1);
				getBbsList(page - 1);
			}
		})
	}
});
</script>

</body>
</html>